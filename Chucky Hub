if not game:IsLoaded() then game.Loaded:Wait() end

-- GUI Button
local ScreenGui = Instance.new("ScreenGui")
local ImageButton = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner")

ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

ImageButton.Parent = ScreenGui
ImageButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ImageButton.BorderSizePixel = 0
ImageButton.Position = UDim2.new(0.05, 0, 0.2, 0)
ImageButton.Size = UDim2.new(0, 40, 0, 40)
ImageButton.Draggable = true
ImageButton.Image = "http://www.roblox.com/asset/?id=79697249956251"

UICorner.CornerRadius = UDim.new(1, 10)
UICorner.Parent = ImageButton

ImageButton.MouseButton1Down:Connect(function()
    game:GetService("VirtualInputManager"):SendKeyEvent(true, Enum.KeyCode.End, false, game)
end)

-- Fluent UI Load
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Chucky Hub",
    SubTitle = "Blox Fruits",
    TabWidth = 160,
    Size = UDim2.fromOffset(480, 320),
    Acrylic = true,
    Theme = "Amethyst",
    MinimizeKey = Enum.KeyCode.End
})

-- Tabs
local Tabs = {
    Main0  = Window:AddTab({ Title = "Thông Tin" }),
    Main1  = Window:AddTab({ Title = "Main Farm" }),
    Main2  = Window:AddTab({ Title = "Config" }),
    Main3  = Window:AddTab({ Title = "Fighting Style" }),
    Main4  = Window:AddTab({ Title = "Item Farm" }),
    Main5  = Window:AddTab({ Title = "Sea Event" }),
    Main6  = Window:AddTab({ Title = "Mirage And RaceV4" }),
    Main7  = Window:AddTab({ Title = "Dragon Dojo" }),
    Main8  = Window:AddTab({ Title = "Prehistoric" }),
    Main9  = Window:AddTab({ Title = "Raid" }),
    Main10 = Window:AddTab({ Title = "Combat PvP" }),
    Main11 = Window:AddTab({ Title = "Teleport" }),
    Main12 = Window:AddTab({ Title = "Fruit" }),
    Main13 = Window:AddTab({ Title = "Shop" }),
    Main14 = Window:AddTab({ Title = "Misc" })
}

-- Thông tin
Tabs.Main0:AddButton({
    Title = "Discord",
    Description = "Tham gia cộng đồng Chucky",
    Callback = function()
        setclipboard("https://discord.gg/BYGNsq82bZ")
        Fluent:Notify({ Title = "Sao chép!", Content = "Đã copy link Discord", Duration = 4 })
    end
})

Tabs.Main0:AddButton({
    Title = "Link Bio",
    Description = "guns.lol/chuckydz",
    Callback = function()
        setclipboard("https://guns.lol/chuckydz")
        Fluent:Notify({ Title = "Sao chép!", Content = "Đã copy link Bio", Duration = 4 })
    end
})

-- MAIN FARM
local function GetQuestName()
    local success, quest = pcall(function()
        return game:GetService("ReplicatedStorage").Remotes.Comm:InvokeServer("GetQuest")
    end)
    return success and quest or nil
end

local function AcceptQuest(questName)
    pcall(function()
        game:GetService("ReplicatedStorage").Remotes.Comm:InvokeServer("StartQuest", questName, 1)
    end)
end

local function FindTargetMob(questName)
    local mobNameMap = {
        ["Pirate Quest"] = "Pirate",
        ["Bandit Quest"] = "Bandit",
        ["Fishman Quest"] = "Fishman",
        ["Zombie Quest"] = "Zombie",
        ["Mink Quest"] = "Mink"
    }
    local mobName = mobNameMap[questName]
    if not mobName then return nil end

    for _, mob in pairs(workspace.Enemies:GetChildren()) do
        if mob.Name == mobName and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
            return mob
        end
    end
    return nil
end

local function TeleportToPosition(pos)
    local hrp = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        hrp.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0))
    end
end

local AutoFarmRunning = false
Tabs.Main1:AddToggle("AutoFarm", { Title = "Auto Farm Level", Default = false }, function(state)
    _G.AutoFarm = state
    if state and not AutoFarmRunning then
        AutoFarmRunning = true
        spawn(function()
            while _G.AutoFarm do
                local quest = GetQuestName()
                if not quest or quest == "" then
                    AcceptQuest("Pirate Quest")
                    task.wait(3)
                else
                    local mob = FindTargetMob(quest)
                    if mob and mob:FindFirstChild("HumanoidRootPart") then
                        TeleportToPosition(mob.HumanoidRootPart.Position)
                        pcall(function()
                            game:GetService("ReplicatedStorage").Remotes.Comm:InvokeServer("Attack", mob.Name)
                        end)
                    else
                        -- Không tìm thấy mob, có thể chờ hoặc làm gì đó
                        task.wait(2)
                    end
                end
                task.wait(0.3)
            end
            AutoFarmRunning = false
        end)
    end
end)


Tabs.Main1:AddToggle("AutoBoss", { Title = "Auto Farm Boss", Default = false }, function(state)
    _G.AutoBoss = state
    while _G.AutoBoss and task.wait(1) do
        print("Đánh Boss...")
    end
end)

Tabs.Main1:AddToggle("AutoMastery", { Title = "Auto Farm Mastery", Default = false }, function(state)
    _G.AutoMastery = state
end)

-- CONFIG
Tabs.Main2:AddDropdown("SelectWeapon", {
    Title = "Chọn vũ khí",
    Values = {"Katana", "Dark Blade", "Cursed Dual Katana"},
    Multi = false,
    Default = 1
}, function(selected)
    _G.SelectedWeapon = selected
end)

-- FIGHTING STYLE
Tabs.Main3:AddButton({
    Title = "Mở khóa Superhuman",
    Callback = function()
        print("Đang mở Superhuman...")
    end
})

Tabs.Main3:AddButton({
    Title = "Mở khóa Godhuman",
    Callback = function()
        print("Đang mở Godhuman...")
    end
})

-- ITEM FARM
Tabs.Main4:AddToggle("AutoFarmBeli", { Title = "Farm Beli", Default = false }, function(state)
    _G.AutoBeli = state
end)

Tabs.Main4:AddToggle("AutoFarmHeart", { Title = "Farm Heart", Default = false }, function(state)
    _G.AutoHeart = state
end)

-- SEA EVENT
Tabs.Main5:AddToggle("AutoSeaBeast", { Title = "Đánh Sea Beast", Default = false }, function(state)
    _G.AutoSeaBeast = state
end)

-- RAID
local AutoRaidRunning = false
local function BuyChip()
    pcall(function()
        game:GetService("ReplicatedStorage").Remotes.Comm:InvokeServer("BuyChip")
    end)
    task.wait(1)
end

local function StartRaid()
    pcall(function()
        game:GetService("ReplicatedStorage").Remotes.Comm:InvokeServer("StartRaid")
    end)
    task.wait(1)
end

Tabs.Main9:AddToggle("AutoRaid", { Title = "Auto Raid", Default = false }, function(state)
    _G.AutoRaid = state
    if state and not AutoRaidRunning then
        AutoRaidRunning = true
        spawn(function()
            while _G.AutoRaid do
                BuyChip()
                StartRaid()
                task.wait(60) -- đợi raid xong
            end
            AutoRaidRunning = false
        end)
    end
end)


-- COMBAT / PvP
Tabs.Main10:AddToggle("KillAura", { Title = "Kill Aura", Default = false }, function(state)
    _G.KillAura = state
end)

Tabs.Main10:AddToggle("AutoAim", { Title = "Auto Aim", Default = false }, function(state)
    _G.AutoAim = state
end)

-- TELEPORT
local islandPositions = {
    ["Starter Island"] = Vector3.new(0, 10, 0),  -- Thay bằng tọa độ thật
    ["Jungle"] = Vector3.new(1000, 20, 2000),
    ["Sky Island"] = Vector3.new(3000, 50, 4000),
    ["Hot & Cold"] = Vector3.new(5000, 10, 6000),
    ["Haunted Castle"] = Vector3.new(7000, 15, 8000)
}

Tabs.Main11:AddDropdown("IslandTP", {
    Title = "Chọn đảo",
    Values = {"Starter Island", "Jungle", "Sky Island", "Hot & Cold", "Haunted Castle"},
    Multi = false
}, function(destination)
    local pos = islandPositions[destination]
    if pos then
        local hrp = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.CFrame = CFrame.new(pos)
            print("Đã dịch chuyển đến:", destination)
        end
    else
        print("Chưa có tọa độ đảo:", destination)
    end
end)

-- SHOP
Tabs.Main13:AddToggle("AutoFruit", { Title = "Auto Mua Trái", Default = false }, function(state)
    _G.AutoBuyFruit = state
    if state then
        spawn(function()
            while _G.AutoBuyFruit do
                pcall(function()
                    game:GetService("ReplicatedStorage").Remotes.Comm:InvokeServer("BuyFruit")
                end)
                task.wait(10)
            end
        end)
    end
end)

-- MISC
Tabs.Main14:AddButton({
    Title = "Xóa cây / vật cản",
    Callback = function()
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("Model") and v.Name:lower():find("tree") then
                v:Destroy()
            end
        end
    end
})

Tabs.Main14:AddButton({
    Title = "Tắt hiệu ứng màn hình",
    Callback = function()
        for _,v in pairs(game:GetService("Lighting"):GetDescendants()) do
            if v:IsA("PostEffect") then v.Enabled = false end
        end
    end
})
